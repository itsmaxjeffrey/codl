"use strict";var e=e||navigator.userAgent.includes("Chrome")?chrome:browser,t=(t,n)=>e.runtime.sendMessage({method:t+"@ui",data:n}),n=(t,n)=>e.runtime.onMessage.addListener((function(e,a){if(e.method===t+"@ui"&&(!a.url||-1!==a.url.indexOf("background")))return n(e.data),!0}));const a=t=>{!function(t,n){const a={};a[t]=n,e.storage.sync.set(a)}("option",t)},r=async()=>{const t=await(n="option",new Promise(((t,a)=>e.storage.sync.get(n,(r=>e.runtime.lastError?a(Error(e.runtime.lastError.message)):t(r?r[n]:void 0))))));var n;let r={counter:0,domain:{},rcounterr:0,recltime:30,reclsize:100};try{t&&Object.assign(r,t),r.counter=Math.max(0,Math.floor(Number(r.counter)||0)),r.rcounterr=Math.max(0,Math.floor(Number(r.rcounterr)||0)),a(r)}catch(e){}return r};async function i(){let e="cococut.net";const t=await r();return t.homedomain&&(e=t.homedomain),e}function s(e){if(0===e)return"0 Byte";let t=Math.floor(Math.log(e)/Math.log(1024));return(e/Math.pow(1024,t)).toFixed(t?1:0)+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][t]}var d,o,c=function(e,t,n,a){let r=function(){};return t.addEventListener("click",(function(){e.dataset.visible=!1,r()})),n.addEventListener("click",(function(){e.dataset.visible=!1})),(t,n)=>{a.textContent=t,e.dataset.visible=!0,r=n||r}}(document.getElementById("confirm"),document.querySelector("#confirm input"),document.querySelector("#confirm input:last-child"),document.querySelector("#confirm span")),l=(d=document.getElementById("notify"),o=document.querySelector("#notify span:nth-child(2)"),document.querySelector("#notify input").addEventListener("click",(()=>d.dataset.visible=!1)),function(e){o.textContent=e,d.dataset.visible=!0});n("notify",l);var u,m,y,f=function(n){var a=document.querySelector('.item[data-id="'+n+'"]');if(!a)return null;var r=a.querySelector("[data-type=overal]>div"),i=a.querySelector("[data-type=percent]"),d=a.querySelector("[data-type=size]"),o=a.querySelector("[data-type=speed]"),c=a.querySelector("[data-type=time]"),l=a.querySelector("[data-type=name]"),u=a.querySelector("[data-type=threads]"),m=a.querySelector("[data-type=retries]"),y=a.querySelector('[data-type="cachedone"]'),f=a.querySelector('[data-type="incache"]'),p=a.querySelector('[data-type="temporay-pause"]'),h=document.querySelector('.ctl-area[data-id="'+n+'"]'),g=h.querySelector("[data-ctlcmd=flushfile]"),v=h.querySelector("[data-ctlcmd=save2gdrive]"),b=h.querySelector("[data-ctltype=autosave]"),S=h.querySelector("[data-ctltype=directlySave]");S&&(function(e,t){if(typeof e+typeof t!="stringstring")return!1;for(var n=e.split("."),a=t.split("."),r=0,i=Math.max(n.length,a.length);r<i;r++){if(n[r]&&!a[r]&&parseInt(n[r])>0||parseInt(n[r])>parseInt(a[r]))return 1;if(a[r]&&!n[r]&&parseInt(a[r])>0||parseInt(n[r])<parseInt(a[r]))return-1}return 0}(e.runtime.getManifest().version,"2.3.7")&&(S.parentElement.style.display="inline",S.addEventListener("click",(function(){S.checked&&t("cmd",{cmd:"setDirectlySave"})}))));if(b){var k={};localStorage.getItem("cococutDlSettings")&&(k=JSON.parse(localStorage.getItem("cococutDlSettings"))),b&&(b.checked=k.setAutoSave),b.addEventListener("click",(function(){k.setAutoSave=b.checked,localStorage.setItem("cococutDlSettings",JSON.stringify(k))}))}var q=h.querySelector("[data-ctltype=filesaved]");return{set percent(e){e=Math.min(100,Math.abs(e)||0),r.style.width=e+"%",i.textContent=e.toFixed(1)+"%"},set size(e){d.textContent=s(e)},get name(){return l.textContent},set name(e){l.textContent=e||l.textContent},set mime(e){a.dataset.mime=e.split("/")[0]},set threads(e){u.textContent=e},set retries(e){m.textContent=e},set speed(e){o.textContent=s(e)+"/s"},set time(e){c.textContent=e},partial:function(e,t,n,r){let i=a.querySelector("[data-type=partial]"),s=i.querySelector('div[data-id="'+e+'"]');s||(s=document.createElement("div"),i.appendChild(s),s.dataset.id=e),s.style.left=t+"%",s.style.width=n?n+"%":"2px",s.style.backgroundColor=r},clear:function(){a.querySelector("[data-type=partial]").innerHTML=""},set status(e){a.dataset.type=e},get chunkable(){return a.dataset.chunkable},set chunkable(e){a.dataset.chunkable=e},showFlushfileBtn:function(){g.style.display="inline",y.style.display="inline",v&&(v.style.display="inline"),f.style.display="none",b&&(b.parentElement.style.display="block")},get autoSaveCheck(){return b},showFilesaved:function(){q.style.display="block"},showErr:function(e){q.innerHTML=e,q.style.display="block",q.style.color="red"},get temporayPause(){return p},get inCache(){return f}}},p=(u=document.getElementById("loader"),m=document.querySelector("#loader iframe"),y=function(){"true"===u.dataset.visible&&(u.dataset.visible=!1,m.src="about:blank")},u.addEventListener("click",(function(e){e.target===this&&y()})),n("hide",y,!1),window.top.document.addEventListener("backbutton",(e=>{e.preventDefault(),y()}),!1),document.addEventListener("keyup",(function(e){27===e.keyCode&&y()}),!1),n("info",(async function(e){u.dataset.visible=!0;const t=await i();m.src=`https://${t}/dlm/info/index.html?id=`+e.id})),n("modify",(async function(e){u.dataset.visible=!0;const t=await i();m.src=`https://${t}/dlm/modify/index.html?id=`+e.id})),void n("job",(e=>p.add(e))));function h(e,t=5){const n=e.lastIndexOf(".");if(-1!==n){const a=e.substring(n),r=e.substring(0,n);if(r.length<=t)return e;return r.substring(0,t)+"xxx"+a}return e.length<=t?e:e.substring(0,t)+"xxx"}function g(e){let t=document.querySelector('.item[data-id="-1"]').cloneNode(!0),n=document.querySelector(".item");t.dataset.id=e,document.getElementById("dlmList").insertBefore(t,n);let a=document.querySelector('.ctl-area[data-id="-1"]').cloneNode(!0);return a.dataset.id=e,document.getElementById("dlmList").insertBefore(a,t.nextSibling),f(e)}function v(e){var t=document.querySelector('.item[data-id="'+e+'"]');t&&t.parentNode.removeChild(t);let n=document.querySelector('.ctl-area[data-id="'+e+'"]');n&&n.parentNode.removeChild(n)}n("remove",v),n("add",(function(e){let t=f(e.id);if(!t){t=g(e.id),t.percent=e.percent||0,t.size=e.size,t.threads=e.threads,t.name=h(e.name),t.mime=e.mime,t.status=e.status,t.speed=e.speed,t.retries=e.retries,t.chunkable=e.chunkable;for(let n in e.stats){let a=e.stats[n];t.partial(n,100*a.start,100*a.width,n)}}"done"===e.status&&t.showFlushfileBtn()})),n("new",(e=>{g(e.id)})),n("percent",(function(e){let t=f(e.id);t&&(t.percent=e.percent)})),n("speed",(function(e){let t=f(e.id);t&&(t.speed=e.speed,t.time=function(e){if(isNaN(e)||!isFinite(e))return"--:--:--:--";let t=e,n=("00"+parseInt(t%60)).substr(-2);t/=60;let a=("00"+parseInt(t%60)).substr(-2);t/=60;let r=("00"+parseInt(t%24)).substr(-2);return t/=24,[("00"+parseInt(t)).substr(-2),r,a,n].join(":")}(e.time))})),n("name",(function(e){let t=f(e.id);t&&(t.name=h(e.name))})),n("mime",(function(e){let t=f(e.id);t&&(t.mime=e.mime)})),n("size",(function(e){let t=f(e.id);t&&(t.size=e.size)})),n("chunkable",(function(e){let t=f(e.id);t&&(t.chunkable=e.chunkable)})),n("status",(function(e){let n=f(e.id);if(n)switch(n.status=e.status,e.status){case"done":n.clear(),n.showFlushfileBtn(),n.autoSaveCheck&&n.autoSaveCheck.checked&&t("cmd",{cmd:"flushfile",id:e.id});break;case"error":n.clear();break;case"pause":e.extraStatus["temporary-pause"]&&(n.temporayPause.style.display="inline",n.inCache.style.display="none");break;case"download":n.temporayPause.style.display="none",n.inCache.style.display="inline"}})),n("count",(function(e){let t=f(e.id);t&&(t.threads=e.count)})),n("retries",(function(e){let t=f(e.id);t&&(t.retries=e.retries)})),n("progress",(function(e){let t=f(e.id);if(t){let n=e.stat;t.partial(n.id,100*n.start,100*n.width,n.id)}})),t("init"),n("save2driveData",(function(e){fetch(e.fileDataURL).then((e=>e.arrayBuffer())).then((e=>{window.postMessage({type:"webResVideoFile",videoFile:e},location.href,[e])}))})),n("willDelFile",(function(e){let t=f(e.id);t&&t.showFilesaved()})),n("bgError",(function(e){let t=f(e.id);t&&t.showErr(e.errMsg)})),document.addEventListener("click",(function(e){let n=e.target;n.dataset.cmd?[].filter.call(document.querySelectorAll(".item"),(e=>e.contains(n))).forEach((function(e){if("pause"===n.dataset.cmd){let n="download"===e.dataset.type?"pause":"resume";"pause"===n&&"false"===e.dataset.chunkable?c("Download is not resumable. Pausing will result in termination. Proceed?",(()=>t("cmd",{id:e.dataset.id,cmd:n}))):t("cmd",{id:e.dataset.id,cmd:n})}else"trash"===n.dataset.cmd?(t("cmd",{id:e.dataset.id,cmd:n.dataset.cmd}),v(e.dataset.id)):t("cmd",{id:e.dataset.id,cmd:n.dataset.cmd})})):n.dataset.ctlcmd&&[].filter.call(document.querySelectorAll(".ctl-area"),(e=>e.contains(n))).forEach((function(e){t("cmd",{id:e.dataset.id,cmd:n.dataset.ctlcmd})}))})),n("confirm",(e=>{c(e.msg,(()=>e.cmd&&t(e.cmd)))})),e=e||navigator.userAgent.includes("Chrome")?chrome:browser;var b={send:(t,n)=>e.runtime.sendMessage({method:t+"@ad",data:n}),send2bgMyAdd:(t,n)=>e.runtime.sendMessage({method:t+"@myAd",data:n}),receive:(t,n)=>e.runtime.onMessage.addListener((function(e,a){if(e.method===t+"@myAd"&&(!a.url||-1!==a.url.indexOf("background")))return n(e.data),!0}))},S=Math.random().toString(36).substring(7);let k,q;b.receive("initDlmHelperFrameBegin",(e=>function(e){S===e.dlmPageId&&(k=e.msgData,q=e.msgData.threads)}(e))),b.send2bgMyAdd("newDlMContentOk",S),b.receive("dlmiframeReady",(function(){k&&function(e,t){b.send("download",{url:e.url,timeout:30,threads:t,dlTargetInfo:e})}(k,q)}));